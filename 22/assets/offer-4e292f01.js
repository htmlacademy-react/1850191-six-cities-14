import{h as u,a as b,u as l,r as n,R as N,p as F,i as y,j as e,k as M,l as T,m as D,n as I,o as E,A as $,q as z,t as g,v as U,e as q,N as H,W as B}from"./index-254e73e7.js";import{c as G,n as W,M as V,L as X}from"./map-746f635c.js";import{F as Y,a as w}from"./cards-934b7f14.js";const R=s=>s.currentOffer.offer,J=s=>s.currentOffer.loading,K=s=>s.currentOffer.requestCompleted,p=s=>s.reviews,O=u([p],s=>s.reviews);u([p],s=>s.loadingReviews);u([p],s=>s.postReviewData);const Q=u([p],s=>s.postReviewLoading),Z=u([p],s=>s.postReviewError),ee=u([O],s=>s.slice().sort((r,i)=>new Date(i.date).getTime()-new Date(r.date).getTime()).slice(0,10)),se=()=>{const s=b(),r=l(Q),i=l(Z),a=l(R),[o,c]=n.useState(""),[d,f]=n.useState(0),m=o.length>=N.MIN&&o.length<=N.MAX&&d>0,v=n.useCallback(t=>{c(t.target.value)},[]),_=n.useCallback(t=>{f(Number(t.target.value))},[]),x=n.useCallback(async t=>{if(t.preventDefault(),m&&!r&&a){const j={id:a.id,rating:d,comment:o};await s(F(j)).unwrap(),c(""),f(0),await s(y(a.id))}},[m,r,a,d,o,s]);return e.jsxs("form",{className:"reviews__form form",onSubmit:t=>{x(t)},children:[e.jsx("label",{className:"reviews__label form__label",htmlFor:"review",children:"Your review"}),e.jsx("div",{className:"reviews__rating-form form__rating",children:M.map(t=>e.jsxs(T.Fragment,{children:[e.jsx("input",{className:"form__rating-input visually-hidden",name:"rating",value:t,id:`${t}-stars`,type:"radio",onChange:_,checked:d===t}),e.jsx("label",{htmlFor:`${t}-stars`,className:"reviews__rating-label form__rating-label",title:["terribly","badly","not bad","good","perfect"][t-1],children:e.jsx("svg",{className:"form__star-image",width:37,height:33,children:e.jsx("use",{xlinkHref:"#icon-star"})})})]},t))}),e.jsx("textarea",{className:"reviews__textarea form__textarea",id:"review",name:"review",placeholder:"Tell how was your stay, what you like and what can be improved",value:o,onChange:v}),e.jsxs("div",{className:"reviews__button-wrapper",children:[e.jsxs("p",{className:"reviews__help",children:["To submit review please make sure to set"," ",e.jsx("span",{className:"reviews__star",children:"rating"})," and describe your stay with at least"," ",e.jsx("b",{className:"reviews__text-amount",children:"50 characters"}),"."]}),e.jsx("button",{className:"reviews__submit form__submit button",type:"submit",disabled:!m||r,children:"Submit"})]}),i&&e.jsx("div",{className:"error-message",children:i})]})},S=n.memo(({review:s})=>{const r=n.useMemo(()=>({width:`${s.rating*20}%`}),[s.rating]),i=new Date(s.date).toLocaleString("en-US",{month:"long",year:"numeric"});return e.jsxs("li",{className:"reviews__item",children:[e.jsxs("div",{className:"reviews__user user",children:[e.jsx("div",{className:"reviews__avatar-wrapper user__avatar-wrapper",children:e.jsx("img",{className:"reviews__avatar user__avatar",src:s.user.avatarUrl,width:54,height:54,alt:"Reviews avatar"})}),e.jsx("span",{className:"reviews__user-name",children:s.user.name})]}),e.jsxs("div",{className:"reviews__info",children:[e.jsx("div",{className:"reviews__rating rating",children:e.jsxs("div",{className:"reviews__stars rating__stars",children:[e.jsx("span",{style:r}),e.jsx("span",{className:"visually-hidden",children:"Rating"})]})}),e.jsx("p",{className:"reviews__text",children:s.comment}),e.jsx("time",{className:"reviews__time",dateTime:s.date,children:i})]})]})});S.displayName="ReviewsItem";const C=n.memo(({reviews:s})=>e.jsx("ul",{className:"reviews__list",children:s.map(r=>e.jsx(S,{review:r},r.id))}));C.displayName="ReviewsList";const A=n.memo(({images:s})=>e.jsx("section",{className:"offer",children:e.jsx("div",{className:"offer__gallery-container container",children:e.jsx("div",{className:"offer__gallery",children:s.slice(0,6).map(r=>e.jsx("div",{className:"offer__image-wrapper",children:e.jsx("img",{className:"offer__image",src:r,alt:r})},r))})})}));A.displayName="OfferGallery";const P=n.memo(({host:s,description:r})=>e.jsxs("div",{className:"offer__host",children:[e.jsx("h2",{className:"offer__host-title",children:"Meet the host"}),e.jsxs("div",{className:"offer__host-user user",children:[e.jsx("div",{className:`offer__avatar-wrapper ${s.isPro?"offer__avatar-wrapper--pro":""} user__avatar-wrapper`,children:e.jsx("img",{className:"offer__avatar user__avatar",src:s.avatarUrl,width:74,height:74,alt:s.avatarUrl})}),e.jsx("span",{className:"offer__user-name",children:s.name}),s.isPro&&e.jsx("span",{className:"offer__user-status",children:"Pro"})]}),e.jsx("div",{className:"offer__description",children:e.jsx("p",{className:"offer__text",children:r})})]}));P.displayName="OfferHost";const k=n.memo(({offer:s,title:r,isPremium:i,rating:a,type:o,bedrooms:c,maxAdults:d,price:f,goods:m})=>{const v=`${Math.round(a/5*100)}%`;return e.jsxs(e.Fragment,{children:[i&&e.jsx("div",{className:"offer__mark",children:e.jsx("span",{children:"Premium"})}),e.jsxs("div",{className:"offer__name-wrapper",children:[e.jsx("h1",{className:"offer__name",children:r}),e.jsx(Y,{offer:s,buttonClass:"offer__bookmark-button",buttonActiveClass:"offer__bookmark-button--active",iconClass:"offer__bookmark-icon",iconWidth:31,iconHeight:33})]}),e.jsxs("div",{className:"offer__rating rating",children:[e.jsxs("div",{className:"offer__stars rating__stars",children:[e.jsx("span",{style:{width:v}}),e.jsx("span",{className:"visually-hidden",children:"Rating"})]}),e.jsx("span",{className:"offer__rating-value rating__value",children:a})]}),e.jsxs("ul",{className:"offer__features",children:[e.jsx("li",{className:"offer__feature offer__feature--entire",children:o}),e.jsxs("li",{className:"offer__feature offer__feature--bedrooms",children:[c," Bedroom",w(c)]}),e.jsxs("li",{className:"offer__feature offer__feature--adults",children:["Max ",d," adult",w(d)]})]}),e.jsxs("div",{className:"offer__price",children:[e.jsxs("b",{className:"offer__price-value",children:["€",f]}),e.jsx("span",{className:"offer__price-text",children:" night"})]}),e.jsxs("div",{className:"offer__inside",children:[e.jsx("h2",{className:"offer__inside-title",children:"What's inside"}),e.jsx("ul",{className:"offer__inside-list",children:m.map(_=>e.jsx("li",{className:"offer__inside-item",children:_},_))})]})]})});k.displayName="OfferPlace";const ie=()=>{const s=b(),r=D(),{id:i}=I(),a=l(R),o=l(J),c=l(G),d=l(W),f=l(ee),v=l(E)===$.Auth,_=l(O),x=l(K),t=n.useRef(!0);n.useEffect(()=>(t.current=!0,i&&(s(z(i)).unwrap().catch(h=>{h.response&&h.response.status===404&&r(g.NotFound)}),s(U(i)),s(y(i))),()=>{t.current=!1}),[i,s,r]);const j=n.useMemo(()=>{let h=c.slice(0,3);return a&&!c.some(L=>L.id===a.id)&&(h=[a,...h]),h},[c,a]);return o||!x?e.jsx(q,{}):a?e.jsxs(e.Fragment,{children:[e.jsx(B,{children:e.jsx("title",{children:`6 cities-Offer: ${a.title}`})}),e.jsxs("section",{className:"offer",children:[e.jsx(A,{images:a.images}),e.jsx("div",{className:"offer__container container",children:e.jsxs("div",{className:"offer__wrapper",children:[e.jsx(k,{offer:a,title:a.title,isPremium:a.isPremium,rating:a.rating,type:a.type,bedrooms:a.bedrooms,maxAdults:a.maxAdults,price:a.price,goods:a.goods}),e.jsx(P,{host:a.host,description:a.description}),e.jsxs("section",{className:"offer__reviews reviews",children:[e.jsxs("h2",{className:"reviews__title",children:["Reviews · ",e.jsx("span",{className:"reviews__amount",children:_.length})]}),e.jsx(C,{reviews:f}),v&&e.jsx(se,{})]})]})}),a.city&&e.jsx(V,{city:a.city,offers:j,className:"offer__map",activeOfferId:a.id})]}),e.jsx("div",{className:"container",children:e.jsxs("section",{className:"near-places places",children:[e.jsx("h2",{className:"near-places__title",children:"Other places in the neighbourhood"}),e.jsx("div",{className:"near-places__list places__list",children:d?e.jsx("div",{children:"Loading nearby places..."}):e.jsx(X,{offers:c.slice(0,3),cardType:"offer"})})]})})]}):e.jsx(H,{to:g.NotFound})};export{ie as default};
