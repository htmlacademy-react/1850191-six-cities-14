import{h as f,M,a as w,u as l,r as n,R as N,p as k,i as R,j as e,k as L,l as T,m as I,n as D,o as U,q as $,A as B,t as q,e as H,W}from"./index-41ebdf80.js";import{c as X,n as G,M as Y,L as z}from"./map-85a329e1.js";import{F as V,a as g}from"./cards-3fc218dd.js";const b=s=>s.currentOffer.offer,J=s=>s.currentOffer.loading,K=s=>s.currentOffer.requestCompleted,x=s=>s.reviews,y=f([x],s=>s.reviews),Q=f([y],s=>s.length);f([x],s=>s.loadingReviews);f([x],s=>s.postReviewData);const Z=f([x],s=>s.postReviewLoading),ee=f([x],s=>s.postReviewError),se=f([y],s=>s.slice().sort((r,t)=>new Date(t.date).getTime()-new Date(r.date).getTime()).slice(0,M)),ae=()=>{const s=w(),r=l(Z),t=l(ee),a=l(b),[o,c]=n.useState(""),[d,_]=n.useState(0),m=o.length>=N.MIN&&o.length<=N.MAX&&d>0,u=n.useCallback(i=>{c(i.target.value)},[]),h=n.useCallback(i=>{_(Number(i.target.value))},[]),p=n.useCallback(async i=>{if(i.preventDefault(),m&&!r&&a){const j={id:a.id,rating:d,comment:o};await s(k(j)).unwrap(),c(""),_(0),await s(R(a.id))}},[m,r,a,d,o,s]);return e.jsxs("form",{className:"reviews__form form",onSubmit:i=>{p(i)},children:[e.jsx("label",{className:"reviews__label form__label",htmlFor:"review",children:"Your review"}),e.jsx("div",{className:"reviews__rating-form form__rating",children:L.map(i=>e.jsxs(T.Fragment,{children:[e.jsx("input",{className:"form__rating-input visually-hidden",name:"rating",value:i,id:`${i}-stars`,type:"radio",onChange:h,checked:d===i}),e.jsx("label",{htmlFor:`${i}-stars`,className:"reviews__rating-label form__rating-label",title:["terribly","badly","not bad","good","perfect"][i-1],children:e.jsx("svg",{className:"form__star-image",width:37,height:33,children:e.jsx("use",{xlinkHref:"#icon-star"})})})]},i))}),e.jsx("textarea",{className:"reviews__textarea form__textarea",id:"review",name:"review",placeholder:"Tell how was your stay, what you like and what can be improved",value:o,onChange:u}),e.jsxs("div",{className:"reviews__button-wrapper",children:[e.jsxs("p",{className:"reviews__help",children:["To submit review please make sure to set"," ",e.jsx("span",{className:"reviews__star",children:"rating"})," and describe your stay with at least"," ",e.jsx("b",{className:"reviews__text-amount",children:"50 characters"}),"."]}),e.jsx("button",{className:"reviews__submit form__submit button",type:"submit",disabled:!m||r,children:"Submit"})]}),t&&e.jsx("div",{className:"error-message",children:t})]})},O=n.memo(({review:s})=>{const r=n.useMemo(()=>({width:`${s.rating*20}%`}),[s.rating]),t=new Date(s.date).toLocaleString("en-US",{month:"long",year:"numeric"});return e.jsxs("li",{className:"reviews__item",children:[e.jsxs("div",{className:"reviews__user user",children:[e.jsx("div",{className:"reviews__avatar-wrapper user__avatar-wrapper",children:e.jsx("img",{className:"reviews__avatar user__avatar",src:s.user.avatarUrl,width:54,height:54,alt:"Reviews avatar"})}),e.jsx("span",{className:"reviews__user-name",children:s.user.name})]}),e.jsxs("div",{className:"reviews__info",children:[e.jsx("div",{className:"reviews__rating rating",children:e.jsxs("div",{className:"reviews__stars rating__stars",children:[e.jsx("span",{style:r}),e.jsx("span",{className:"visually-hidden",children:"Rating"})]})}),e.jsx("p",{className:"reviews__text",children:s.comment}),e.jsx("time",{className:"reviews__time",dateTime:s.date,children:t})]})]})});O.displayName="ReviewsItem";const A=n.memo(({reviews:s})=>e.jsx("ul",{className:"reviews__list",children:s.map(r=>e.jsx(O,{review:r},r.id))}));A.displayName="ReviewsList";const S=n.memo(({images:s})=>e.jsx("section",{className:"offer",children:e.jsx("div",{className:"offer__gallery-container container",children:e.jsx("div",{className:"offer__gallery",children:s.slice(0,6).map(t=>e.jsx("div",{className:"offer__image-wrapper",children:e.jsx("img",{className:"offer__image",src:t,alt:t})},t))})})}));S.displayName="OfferGallery";const C=n.memo(({host:s,description:r})=>e.jsxs("div",{className:"offer__host",children:[e.jsx("h2",{className:"offer__host-title",children:"Meet the host"}),e.jsxs("div",{className:"offer__host-user user",children:[e.jsx("div",{className:`offer__avatar-wrapper ${s.isPro?"offer__avatar-wrapper--pro":""} user__avatar-wrapper`,children:e.jsx("img",{className:"offer__avatar user__avatar",src:s.avatarUrl,width:74,height:74,alt:s.avatarUrl})}),e.jsx("span",{className:"offer__user-name",children:s.name}),s.isPro&&e.jsx("span",{className:"offer__user-status",children:"Pro"})]}),e.jsx("div",{className:"offer__description",children:e.jsx("p",{className:"offer__text",children:r})})]}));C.displayName="OfferHost";const P=n.memo(({offer:s,title:r,isPremium:t,rating:a,type:o,bedrooms:c,maxAdults:d,price:_,goods:m})=>{const u=`${Math.round(a/5*100)}%`;return e.jsxs(e.Fragment,{children:[t&&e.jsx("div",{className:"offer__mark",children:e.jsx("span",{children:"Premium"})}),e.jsxs("div",{className:"offer__name-wrapper",children:[e.jsx("h1",{className:"offer__name",children:r}),e.jsx(V,{offer:s,buttonClass:"offer__bookmark-button",buttonActiveClass:"offer__bookmark-button--active",iconClass:"offer__bookmark-icon",iconWidth:31,iconHeight:33})]}),e.jsxs("div",{className:"offer__rating rating",children:[e.jsxs("div",{className:"offer__stars rating__stars",children:[e.jsx("span",{style:{width:u}}),e.jsx("span",{className:"visually-hidden",children:"Rating"})]}),e.jsx("span",{className:"offer__rating-value rating__value",children:a})]}),e.jsxs("ul",{className:"offer__features",children:[e.jsx("li",{className:"offer__feature offer__feature--entire",children:o}),e.jsxs("li",{className:"offer__feature offer__feature--bedrooms",children:[c," Bedroom",g(c)]}),e.jsxs("li",{className:"offer__feature offer__feature--adults",children:["Max ",d," adult",g(d)]})]}),e.jsxs("div",{className:"offer__price",children:[e.jsxs("b",{className:"offer__price-value",children:["€",_]}),e.jsx("span",{className:"offer__price-text",children:" night"})]}),e.jsxs("div",{className:"offer__inside",children:[e.jsx("h2",{className:"offer__inside-title",children:"What's inside"}),e.jsx("ul",{className:"offer__inside-list",children:m.map(h=>e.jsx("li",{className:"offer__inside-item",children:h},h))})]})]})});P.displayName="OfferPlace";const ne=()=>{const s=w(),r=I(),{id:t}=D(),a=l(b),o=l(J),c=l(X),d=l(G),_=l(se),m=l(U),u=l(Q),h=l(K),p=n.useRef(!0),i=3,j=3;n.useEffect(()=>{if(t)return p.current=!0,s($(t)).unwrap().catch(v=>{v.message==="Not Found"&&r(B.NotFound)}),s(q(t)),s(R(t)),()=>{p.current=!1}},[t,s,r]);const E=n.useMemo(()=>{let v=c.slice(0,i);return a&&!c.some(F=>F.id===a.id)&&(v=[a,...v]),v},[c,a]);return o||!h?e.jsx(H,{}):a?e.jsxs(e.Fragment,{children:[e.jsx(W,{children:e.jsx("title",{children:`6 cities-Offer: ${a.title}`})}),e.jsxs("section",{className:"offer",children:[e.jsx(S,{images:a.images}),e.jsx("div",{className:"offer__container container",children:e.jsxs("div",{className:"offer__wrapper",children:[e.jsx(P,{offer:a,title:a.title,isPremium:a.isPremium,rating:a.rating,type:a.type,bedrooms:a.bedrooms,maxAdults:a.maxAdults,price:a.price,goods:a.goods}),e.jsx(C,{host:a.host,description:a.description}),e.jsxs("section",{className:"offer__reviews reviews",children:[e.jsxs("h2",{className:"reviews__title",children:["Reviews · ",e.jsx("span",{className:"reviews__amount",children:u})]}),e.jsx(A,{reviews:_}),m&&e.jsx(ae,{})]})]})}),a.city&&e.jsx(Y,{city:a.city,offers:E,className:"offer__map",activeOfferId:a.id})]}),e.jsx("div",{className:"container",children:e.jsxs("section",{className:"near-places places",children:[e.jsx("h2",{className:"near-places__title",children:"Other places in the neighbourhood"}),e.jsx("div",{className:"near-places__list places__list",children:d?e.jsx("div",{children:"Loading nearby places..."}):e.jsx(z,{offers:c.slice(0,j),cardType:"offer"})})]})})]}):null};export{ne as default};
